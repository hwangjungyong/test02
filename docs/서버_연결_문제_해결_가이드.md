# 서버 연결 문제 해결 가이드

## 문제: "API 서버에 연결할 수 없습니다" 오류

### 증상
- 브라우저에서 "API 서버에 연결할 수 없습니다" 오류 메시지 표시
- `start-dev.bat` 실행 후에도 서버가 연결되지 않음

### 원인
1. **포트 체크 로직 문제**: `start-dev.bat`의 포트 체크가 LISTENING 상태를 정확히 확인하지 않음
2. **서버 시작 실패**: 데이터베이스 초기화 오류 또는 포트 충돌
3. **서버 시작 지연**: 서버가 시작되는 데 시간이 걸려 포트가 아직 열리지 않음

### 해결 방법

#### 방법 1: 개선된 start-dev.bat 사용 (권장)
개선된 `start-dev.bat` 파일이 다음을 수행합니다:
- ✅ LISTENING 상태를 정확히 확인
- ✅ 서버 시작 후 포트 상태 검증
- ✅ 에러 발생 시 명확한 메시지 표시

**사용 방법:**
```bash
start-dev.bat
```

서버가 시작되면 5초 후 자동으로 포트 상태를 확인하고 결과를 표시합니다.

#### 방법 2: 서버를 개별적으로 실행
각 서버를 개별적으로 실행하여 문제를 진단할 수 있습니다:

**API 서버만 실행:**
```bash
npm run api-server
```

**Python HTTP 서버만 실행:**
```bash
npm run screen-validator-server
```

**Vite 개발 서버만 실행:**
```bash
npm run dev
```

#### 방법 3: 포트 상태 확인 및 정리
포트가 이미 사용 중인지 확인하고 필요시 정리:

```bash
# 포트 사용 상태 확인
netstat -ano | findstr ":3001 :3002 :5173"

# 포트를 사용하는 프로세스 종료 (필요시)
scripts\check-ports.bat
```

#### 방법 4: 데이터베이스 파일 확인
데이터베이스 파일 권한 문제가 있을 수 있습니다:

```bash
# 데이터베이스 파일 확인
dir data\database.db

# 권한 문제가 있으면 파일 삭제 후 재생성 (주의: 데이터 손실)
del data\database.db
```

### 서버 상태 확인

#### 포트 확인
```bash
netstat -ano | findstr ":3001 :3002 :5173" | findstr LISTENING
```

정상적인 경우:
- 포트 3001: API 서버
- 포트 3002: Python HTTP 서버
- 포트 5173: Vite 개발 서버

#### 서버 응답 확인
```bash
# API 서버 확인
curl http://localhost:3001/api-docs

# Python HTTP 서버 확인
curl http://localhost:3002/health

# Vite 개발 서버 확인
curl http://localhost:5173
```

### 자동 실행 스크립트 사용

VDI 환경에서 자동 실행이 설정되어 있다면:
```bash
# 자동 실행 설치
install-auto-start.bat

# 자동 실행 스크립트 (서버 모니터링)
auto-start-servers.bat
```

**주의**: 자동 실행이 활성화되어 있으면 `start-dev.bat`를 수동으로 실행할 필요가 없습니다.

### 문제 해결 체크리스트

- [ ] Node.js가 설치되어 있는지 확인: `node --version`
- [ ] Python이 설치되어 있는지 확인: `python --version`
- [ ] 포트가 사용 중인지 확인: `netstat -ano | findstr ":3001"`
- [ ] 데이터베이스 파일 권한 확인: `data\database.db`
- [ ] 서버 로그 확인: 서버 실행 창의 에러 메시지 확인
- [ ] 방화벽 설정 확인: 포트 3001, 3002, 5173이 차단되지 않았는지 확인

### 추가 도움말

문제가 계속되면:
1. 서버 실행 창의 전체 에러 메시지를 확인하세요
2. `data\database.db` 파일을 삭제하고 재시작해보세요 (주의: 데이터 손실)
3. Node.js와 Python을 최신 버전으로 업데이트하세요
4. 프로젝트 의존성을 재설치하세요: `npm install`

### 개선 사항 (2024-12-20)

`start-dev.bat` 파일이 다음 기능으로 개선되었습니다:
- ✅ LISTENING 상태를 정확히 확인하는 포트 체크
- ✅ 서버 시작 후 자동 포트 검증 (5초 대기)
- ✅ 서버 시작 실패 시 명확한 에러 메시지 및 문제 해결 가이드 표시
- ✅ 서버 상태 요약 정보 표시

