# 🔍 에러 로그 분석 MCP 서버 완전 가이드

**작성일**: 2025년 1월  
**버전**: 1.0.0

> 워크스페이스의 에러 로그를 자동으로 분석하고, 조치 방법과 재발 방지책을 제안하는 MCP 서버

---

## 📋 목차

1. [개요](#개요)
2. [주요 기능](#주요-기능)
3. [설치 및 설정](#설치-및-설정)
4. [사용 방법](#사용-방법)
5. [지원하는 로그 형식](#지원하는-로그-형식)
6. [에러 분석 기능](#에러-분석-기능)
7. [출력 형식](#출력-형식)
8. [예시](#예시)
9. [문제 해결](#문제-해결)

---

## 개요

**에러 로그 분석 MCP 서버**는 워크스페이스에서 에러 로그 파일을 자동으로 찾아 분석하고, 다음과 같은 정보를 제공합니다:

- ✅ 에러 로그 요약 (테이블 형식)
- ✅ 에러 분석 및 분류
- ✅ 상세 에러 내역
- ✅ 조치 방법 제안
- ✅ 재발 방지책 제안

### 지원하는 로그 형식

- **GCP Cloud Logging** 형식
- **일반 애플리케이션 로그** (ISO8601, Standard, Simple 형식)
- **자동 형식 감지** 및 파싱

---

## 주요 기능

### 1. 자동 로그 파일 검색

워크스페이스에서 다음 위치에서 로그 파일을 자동으로 찾습니다:

- `logs/` 디렉토리
- `log/` 디렉토리
- `var/log/` 디렉토리
- `tmp/` 디렉토리
- 루트 디렉토리의 `*.log`, `*.err`, `*.error` 파일

### 2. 지능형 로그 파싱

- **GCP 로그**: `resource.type`, `serviceName`, `location`, `timestamp` 등 자동 추출
- **일반 로그**: 타임스탬프, 에러 레벨, 메시지, 파일 경로, 라인 번호 자동 추출

### 3. 에러 타입 자동 분류

다음과 같은 에러 타입을 자동으로 분류합니다:

- **database**: 데이터베이스 연결, 쿼리 오류
- **network**: 네트워크 연결, 타임아웃 오류
- **authentication**: 인증, 권한 오류
- **memory**: 메모리 부족, OOM 오류
- **file**: 파일 접근, 권한 오류
- **syntax**: 문법 오류, 파싱 오류

### 4. 조치 방법 및 재발 방지책 제안

각 에러 타입에 맞는 구체적인 조치 방법과 재발 방지책을 제안합니다.

---

## 설치 및 설정

### 1. 의존성 설치

```bash
pip install mcp
```

또는 `requirements.txt`가 있는 경우:

```bash
pip install -r requirements.txt
```

### 2. MCP 설정 파일 업데이트

`cursor-mcp-config.json` 파일에 다음 내용이 이미 추가되어 있습니다:

```json
{
  "mcpServers": {
    "error-log-analyzer": {
      "command": "python",
      "args": ["C:/test/test02/mcp-error-log-analyzer.py"],
      "cwd": "C:/test/test02",
      "description": "에러 로그 자동 분석 서버 - GCP 및 일반 로그 분석, 조치 방법 및 재발 방지책 제안",
      "tools": [
        "analyze_error_logs"
      ]
    }
  }
}
```

### 3. 서버 실행 확인

Cursor AI를 재시작하면 자동으로 MCP 서버가 로드됩니다.

---

## 사용 방법

### 기본 사용법

워크스페이스에서 자동으로 로그 파일을 찾아 분석:

```
"워크스페이스의 에러 로그를 분석해줘"
```

또는:

```
"에러 로그를 분석해줘"
```

### 특정 로그 파일 지정

특정 로그 파일을 지정하여 분석:

```
"이 로그 파일을 분석해줘: C:/path/to/error.log"
```

### 특정 워크스페이스 지정

다른 워크스페이스의 로그를 분석:

```
"이 경로의 에러 로그를 분석해줘: C:/other/workspace"
```

---

## 지원하는 로그 형식

### 1. GCP Cloud Logging 형식

```
2024-01-15T10:30:45.123Z ERROR resource.type="gce_instance" serviceName="my-service" location="us-central1-a" textPayload="Database connection failed"
```

**추출 정보:**
- 발생일시: `2024-01-15T10:30:45.123Z`
- 에러사항: `Database connection failed`
- 발생위치: `us-central1-a`
- 관련프로그램: `my-service`

### 2. ISO8601 형식

```
2024-01-15T10:30:45.123Z ERROR: Database connection failed at line 42 in database.py
```

**추출 정보:**
- 발생일시: `2024-01-15T10:30:45.123Z`
- 에러사항: `Database connection failed at line 42 in database.py`
- 발생위치: `database.py`
- 라인번호: `42`

### 3. Standard 형식

```
2024-01-15 10:30:45 ERROR: Network timeout occurred
```

**추출 정보:**
- 발생일시: `2024-01-15 10:30:45`
- 에러사항: `Network timeout occurred`

### 4. Simple 형식

```
01/15/2024 10:30:45 ERROR: File not found: config.json
```

**추출 정보:**
- 발생일시: `01/15/2024 10:30:45`
- 에러사항: `File not found: config.json`

---

## 에러 분석 기능

### 에러 타입별 분류

서버는 에러 메시지의 키워드를 분석하여 에러 타입을 자동으로 분류합니다:

| 에러 타입 | 키워드 예시 | 설명 |
|---------|-----------|------|
| **database** | database, connection, sql, query, db | 데이터베이스 관련 오류 |
| **network** | network, timeout, refused, socket | 네트워크 관련 오류 |
| **authentication** | auth, unauthorized, token, credential | 인증/권한 관련 오류 |
| **memory** | memory, out of memory, oom, heap | 메모리 관련 오류 |
| **file** | file, not found, permission denied | 파일 관련 오류 |
| **syntax** | syntax, parse, invalid, unexpected | 문법/파싱 오류 |

### 조치 방법 제안

각 에러 타입에 맞는 구체적인 조치 방법을 제안합니다:

**예시: Database 에러**
1. 데이터베이스 연결 상태를 확인하세요.
2. 데이터베이스 서버가 실행 중인지 확인하세요.
3. 연결 문자열과 인증 정보를 확인하세요.
4. 데이터베이스 로그를 확인하여 추가 정보를 얻으세요.

### 재발 방지책 제안

각 에러 타입에 맞는 재발 방지책을 제안합니다:

**예시: Database 에러**
1. 연결 풀링을 구현하여 연결 관리를 최적화하세요.
2. 데이터베이스 연결에 재시도 로직을 추가하세요.
3. 연결 타임아웃을 적절히 설정하세요.
4. 정기적으로 데이터베이스 상태를 모니터링하세요.

---

## 출력 형식

서버는 다음과 같은 형식으로 결과를 출력합니다:

### 1. 에러 로그 요약 (테이블)

```
========================================================================================================================
번호   발생일시                   에러사항                              발생위치            관련프로그램
========================================================================================================================
1      2024-01-15T10:30:45.123Z  Database connection failed            us-central1-a       my-service
2      2024-01-15T10:31:12.456Z  Network timeout occurred             database.py         application
========================================================================================================================
```

### 2. 에러 분석 (테이블)

```
========================================================================================================================
번호   에러타입        에러내용                                        매칭키워드
========================================================================================================================
1      database       Database connection failed                      database, connection
2      network        Network timeout occurred                        network, timeout
========================================================================================================================
```

### 3. 상세 에러 내역

각 에러에 대한 상세 정보:

- **발생일시**: 에러가 발생한 정확한 시간
- **심각도**: ERROR, WARNING, CRITICAL 등
- **에러사항**: 에러 메시지
- **발생위치**: 파일 경로 또는 위치 정보
- **관련프로그램**: 서비스 이름 또는 리소스 타입
- **라인번호**: 에러가 발생한 코드 라인 (가능한 경우)

### 4. 조치 방법

에러 타입별로 구체적인 조치 방법을 제시합니다.

### 5. 재발 방지책

에러 타입별로 재발을 방지하기 위한 방법을 제시합니다.

---

## 예시

### 예시 1: GCP 로그 분석

**입력:**
```
"GCP 에러 로그를 분석해줘"
```

**출력:**
```
========================================================================================================================
📁 로그 파일: C:/test/test02/logs/gcp-error.log
📊 로그 타입: GCP
========================================================================================================================

## 1. 에러 로그 요약 (테이블)
========================================================================================================================
번호   발생일시                   에러사항                              발생위치            관련프로그램
========================================================================================================================
1      2024-01-15T10:30:45.123Z  Database connection failed            us-central1-a       my-service
========================================================================================================================

## 2. 에러 분석 (테이블)
========================================================================================================================
번호   에러타입        에러내용                                        매칭키워드
========================================================================================================================
1      database       Database connection failed                      database, connection
========================================================================================================================

## 3. 상세 에러 내역

### 에러 #1
- **발생일시**: 2024-01-15T10:30:45.123Z
- **심각도**: ERROR
- **에러사항**: Database connection failed
- **발생위치**: us-central1-a
- **관련프로그램**: my-service

## 4. 조치 방법

### DATABASE 타입 에러 조치 방법:
1. 데이터베이스 연결 상태를 확인하세요.
2. 데이터베이스 서버가 실행 중인지 확인하세요.
3. 연결 문자열과 인증 정보를 확인하세요.
4. 데이터베이스 로그를 확인하여 추가 정보를 얻으세요.

## 5. 재발 방지책

### DATABASE 타입 에러 재발 방지책:
1. 연결 풀링을 구현하여 연결 관리를 최적화하세요.
2. 데이터베이스 연결에 재시도 로직을 추가하세요.
3. 연결 타임아웃을 적절히 설정하세요.
4. 정기적으로 데이터베이스 상태를 모니터링하세요.
```

### 예시 2: 일반 애플리케이션 로그 분석

**입력:**
```
"애플리케이션 로그를 분석해줘"
```

**출력:**
```
========================================================================================================================
📁 로그 파일: C:/test/test02/logs/app.log
📊 로그 타입: ISO8601
========================================================================================================================

## 1. 에러 로그 요약 (테이블)
========================================================================================================================
번호   발생일시                   에러사항                              발생위치            관련프로그램
========================================================================================================================
1      2024-01-15T10:30:45.123Z  Network timeout occurred             api.py              ERROR
2      2024-01-15T10:31:12.456Z  File not found: config.json          config.py           ERROR
========================================================================================================================

## 2. 에러 분석 (테이블)
========================================================================================================================
번호   에러타입        에러내용                                        매칭키워드
========================================================================================================================
1      network        Network timeout occurred                        network, timeout
2      file           File not found: config.json                     file, not found
========================================================================================================================

## 3. 상세 에러 내역

### 에러 #1
- **발생일시**: 2024-01-15T10:30:45.123Z
- **심각도**: ERROR
- **에러사항**: Network timeout occurred
- **발생위치**: api.py
- **관련프로그램**: ERROR

### 에러 #2
- **발생일시**: 2024-01-15T10:31:12.456Z
- **심각도**: ERROR
- **에러사항**: File not found: config.json
- **발생위치**: config.py
- **관련프로그램**: ERROR

## 4. 조치 방법

### NETWORK 타입 에러 조치 방법:
1. 네트워크 연결 상태를 확인하세요.
2. 방화벽 설정을 확인하세요.
3. 서버가 실행 중인지 확인하세요.
4. 타임아웃 설정을 확인하고 필요시 증가시키세요.
5. DNS 설정을 확인하세요.

### FILE 타입 에러 조치 방법:
1. 파일 경로가 올바른지 확인하세요.
2. 파일 접근 권한을 확인하세요.
3. 디렉토리가 존재하는지 확인하세요.
4. 디스크 공간이 충분한지 확인하세요.

## 5. 재발 방지책

### NETWORK 타입 에러 재발 방지책:
1. 네트워크 요청에 재시도 로직을 구현하세요.
2. 서킷 브레이커 패턴을 적용하세요.
3. 네트워크 상태를 모니터링하는 헬스체크를 구현하세요.
4. 타임아웃 값을 환경 변수로 관리하여 쉽게 조정할 수 있게 하세요.

### FILE 타입 에러 재발 방지책:
1. 파일 경로를 환경 변수로 관리하세요.
2. 파일 접근 전에 존재 여부를 확인하는 로직을 추가하세요.
3. 파일 권한을 적절히 설정하세요.
4. 디스크 공간을 모니터링하세요.
```

---

## 문제 해결

### 문제 1: 로그 파일을 찾을 수 없음

**증상:**
```
워크스페이스(C:/test/test02)에서 로그 파일을 찾을 수 없습니다.
```

**해결 방법:**
1. 로그 파일이 다음 위치에 있는지 확인:
   - `logs/` 디렉토리
   - `log/` 디렉토리
   - `*.log` 파일 (루트 디렉토리)
2. 로그 파일 경로를 직접 지정:
   ```
   "이 로그 파일을 분석해줘: C:/path/to/error.log"
   ```

### 문제 2: 로그 형식을 인식하지 못함

**증상:**
```
에러를 찾을 수 없습니다.
```

**해결 방법:**
1. 로그 파일이 올바른 형식인지 확인
2. 에러 메시지에 "ERROR", "WARN", "CRITICAL" 등의 키워드가 포함되어 있는지 확인
3. 로그 파일의 인코딩이 UTF-8인지 확인

### 문제 3: MCP 서버가 실행되지 않음

**증상:**
```
MCP 서버가 인식되지 않습니다.
```

**해결 방법:**
1. `cursor-mcp-config.json` 파일이 올바른 위치에 있는지 확인
2. Python이 설치되어 있고 PATH에 있는지 확인:
   ```bash
   python --version
   ```
3. MCP SDK가 설치되어 있는지 확인:
   ```bash
   pip show mcp
   ```
4. Cursor AI를 재시작

### 문제 4: 분석 결과가 부정확함

**해결 방법:**
1. 로그 파일의 형식이 표준 형식인지 확인
2. 에러 메시지가 명확한지 확인
3. 필요시 로그 파일을 수정하여 더 명확한 정보 제공

---

## 추가 정보

### 로그 파일 권장 형식

가장 정확한 분석을 위해 다음 형식을 권장합니다:

```
YYYY-MM-DD HH:MM:SS [LEVEL] Message
```

또는:

```
YYYY-MM-DDTHH:MM:SS.sssZ [LEVEL] Message
```

### 에러 메시지 작성 권장사항

- 에러 메시지에 구체적인 정보 포함 (파일 경로, 라인 번호 등)
- 에러 타입을 명확히 표시 (ERROR, WARNING 등)
- 컨텍스트 정보 포함 (서비스 이름, 리소스 타입 등)

---

## 관련 문서

- [`MCP_서버_완전_가이드.md`](../MCP_서버_완전_가이드.md) - MCP 서버 전체 가이드
- [`문서_목록.md`](./문서_목록.md) - 프로젝트 문서 목록

---

**마지막 업데이트**: 2025년 1월

