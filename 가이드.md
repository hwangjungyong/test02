# 📚 프로젝트 완전 가이드

> **초등학생도 이해할 수 있는 쉬운 설명**으로 작성된 통합 가이드입니다.

**마지막 업데이트**: 2025년 1월  
**프로젝트 버전**: 0.0.0

> **💡 코드 구조 개선 진행 중**: 더 나은 유지보수와 협업을 위해 코드를 모듈화하고 있습니다. 자세한 내용은 [`코드_구조_개선_계획.md`](./코드_구조_개선_계획.md)를 참조하세요.

---

## 📋 목차

1. [프로젝트가 뭔가요?](#프로젝트가-뭔가요)
2. [프로젝트 구조 이해하기 (초등학생도 이해 가능!)](#프로젝트-구조-이해하기-초등학생도-이해-가능)
3. [빠른 시작 (5분 안에 실행하기)](#빠른-시작-5분-안에-실행하기)
4. [주요 기능 설명](#주요-기능-설명)
5. [사용자 인증 및 관리](#사용자-인증-및-관리)
6. [API 키 사용 방법](#api-키-사용-방법)
7. [MCP 서버 설정](#mcp-서버-설정)
8. [데이터 저장 위치](#데이터-저장-위치)
9. [데이터베이스 스키마 조회](#데이터베이스-스키마-조회-기능)
10. [문제 해결](#문제-해결)

---

## 프로젝트가 뭔가요?

### 🎯 프로젝트 이름
**AI 기반 뉴스/음악/도서 추천 및 수집 시스템**

### 📖 간단한 설명
이 프로젝트는 **인공지능(AI)을 활용해서 뉴스, 음악, 책을 찾아주고 추천해주는 웹사이트**입니다.

**마치 이런 거예요:**
- 📰 **뉴스 검색**: "AI"라고 검색하면 AI 관련 뉴스를 찾아줍니다
- 🎵 **음악 추천**: 좋아하는 노래를 입력하면 비슷한 노래를 추천해줍니다
- 📚 **책 추천**: 관심 있는 주제를 입력하면 관련 책을 추천해줍니다
- 👤 **회원가입**: 내가 찾은 뉴스, 음악, 책을 저장해둘 수 있습니다
- 🔑 **API 키**: 외부에서 이 프로젝트의 기능을 사용할 수 있습니다

---

## 프로젝트 구조 이해하기 (초등학생도 이해 가능!)

### 🏗️ 전체 구조 (집에 비유하면?)

```
프로젝트 = 집이라고 생각해보세요!

🏠 집 (프로젝트)
│
├── 🚪 현관 (프론트엔드 - Vue)
│   └── 사용자가 보는 화면 (웹페이지)
│   └── 버튼 클릭, 검색 입력 등
│   └── 사용자가 "AI" 검색하면 여기서 입력받음
│
├── 🏢 주방 (백엔드 - API 서버)
│   └── 실제 일을 처리하는 곳
│   └── 뉴스 검색, 음악 추천 등
│   └── 외부 API(News API, Last.fm 등)와 대화
│
├── 📦 창고 (데이터베이스)
│   └── 사용자 정보, 저장한 뉴스/음악/책 저장
│   └── SQLite 데이터베이스 파일 (database.db)
│
└── 🔌 전기 (MCP 서버)
    └── Cursor AI와 대화할 수 있게 해주는 서버
    └── Cursor AI가 "5와 7을 더해줘"라고 하면 처리해줌
```

### 📁 파일 구조 (어떤 파일이 뭘 하나요?)

```
test02/                          # 프로젝트 폴더
│
├── 📄 src/                      # 프론트엔드 (사용자가 보는 화면)
│   ├── App.vue                  # 메인 화면 파일 (리팩토링 진행 중)
│   ├── main.js                  # 시작점 (프로그램이 시작되는 곳)
│   ├── components/              # 컴포넌트 폴더
│   │   ├── features/            # 기능별 컴포넌트 (리팩토링 진행 중)
│   │   ├── modals/              # 모달 컴포넌트
│   │   ├── LoginModal.vue       # 로그인 모달
│   │   └── SignupModal.vue      # 회원가입 모달
│   ├── services/                # API 서비스 레이어 (신규)
│   │   ├── api.js               # 기본 API 호출 함수
│   │   └── newsService.js       # 뉴스 관련 API 서비스
│   ├── stores/                  # 상태 관리
│   │   └── auth.js              # 로그인/회원가입 관리
│   ├── utils/                   # 유틸리티 함수 (신규)
│   │   └── helpers.js           # 공통 헬퍼 함수
│   └── style.css                # 화면 디자인 (예쁘게 꾸미기)
│
├── 🔧 api-server.js             # 백엔드 서버 (포트 3001)
│   └── 뉴스, 음악, 책 API 처리
│   └── 로그인/회원가입 처리
│   └── API 키 관리
│   └── 사용자 데이터 관리
│
├── 🐍 mcp-unified-server.py     # Python MCP 서버
│   └── Cursor AI와 통신
│   └── 책 검색 기능 제공
│   └── 숫자 더하기 기능 제공
│
├── 📦 database.js               # 데이터베이스 관리
│   └── 사용자 정보 저장/조회
│   └── 뉴스/음악/책 저장/조회
│   └── API 키 저장/조회
│
├── 📊 data/                     # 데이터 저장 폴더
│   └── database.db              # SQLite 데이터베이스 파일 (실제 데이터 저장!)
│
├── 🚀 start-dev.bat             # 개발 서버 실행 (가장 중요!)
│   └── 이 파일 하나로 모든 서버 실행!
│
├── 📚 가이드.md                  # 이 파일! (지금 보고 있는 문서)
│
└── 📖 README.md                 # 간단한 설명서
```

### 🔄 데이터 흐름 (어떻게 작동하나요?)

**예시: 사용자가 "AI" 뉴스를 검색할 때**

```
1. 사용자가 웹사이트에서 "AI" 검색
   ↓
2. 프론트엔드(Vue)가 백엔드(API 서버)에 요청
   "뉴스 검색해줘! 키워드는 'AI'야!"
   ↓
3. 백엔드가 외부 API(News API)에 요청
   "News API야, 'AI' 관련 뉴스 찾아줘!"
   ↓
4. 외부 API가 뉴스 데이터 반환
   "여기 뉴스 100개 있어!"
   ↓
5. 백엔드가 데이터 처리 후 프론트엔드에 전달
   "처리 완료! 뉴스 100개 전달할게!"
   ↓
6. 프론트엔드가 화면에 표시
   "사용자님, 뉴스 100개 찾았어요!"
```

**예시: 사용자가 로그인할 때**

```
1. 사용자가 이메일/비밀번호 입력
   ↓
2. 프론트엔드가 백엔드에 로그인 요청
   ↓
3. 백엔드가 데이터베이스에서 사용자 확인
   ↓
4. 비밀번호가 맞으면 JWT 토큰 발급
   ↓
5. 프론트엔드가 토큰 저장 (localStorage)
   ↓
6. 이후 모든 요청에 토큰 포함하여 인증
```

---

## 빠른 시작 (5분 안에 실행하기)

### 1단계: 필요한 것 설치하기

**Node.js가 설치되어 있어야 합니다!**
- 확인 방법: 명령 프롬프트(CMD)에서 `node --version` 입력
- 없으면: https://nodejs.org 에서 다운로드 (LTS 버전 권장)

**Python이 설치되어 있어야 합니다!**
- 확인 방법: 명령 프롬프트에서 `python --version` 입력
- 없으면: https://www.python.org 에서 다운로드

### 2단계: 패키지 설치하기

```bash
# 1. Node.js 패키지 설치
npm install

# 2. Python 패키지 설치
pip install mcp playwright

# 3. 브라우저 설치 (Playwright용)
playwright install chromium
```

### 3단계: 환경 변수 설정 (선택사항)

`.env` 파일을 생성하고 API 키를 설정하세요:

```env
# News API 키 (필수)
NEWS_API_KEY=your_news_api_key_here

# Last.fm API 키 (필수)
LASTFM_API_KEY=your_lastfm_api_key_here

# JWT 비밀키 (선택사항, 기본값 사용 가능)
JWT_SECRET=your_secret_key_here
JWT_EXPIRES_IN=7d

# 프록시 URL (필요한 경우만)
PROXY_URL=http://your-proxy-url:port
```

### 4단계: 서버 실행하기

**가장 쉬운 방법:**
```bash
start-dev.bat
```

이 명령어 하나면 모든 서버가 자동으로 실행됩니다!

**실행되는 서버:**
- ✅ API 서버 시작 (포트 3001)
- ✅ Python HTTP 서버 시작 (포트 3002)
- ✅ Vite 개발 서버 시작 (포트 5173)

### 5단계: 브라우저에서 열기

```
http://localhost:5173
```

이 주소를 브라우저에 입력하면 웹사이트가 열립니다!

---

## 주요 기능 설명

### 📰 1. AI 뉴스 검색

**무엇을 하나요?**
- 키워드를 입력하면 AI 관련 뉴스를 검색합니다
- 최근 일주일 이내의 뉴스만 보여줍니다
- 키워드 간의 관계를 그래프로 보여줍니다
- 뉴스를 저장할 수 있습니다

**사용 방법:**
1. 웹사이트에서 "AI 뉴스 검색" 섹션 찾기
2. 검색어 입력 (예: "ChatGPT")
3. "검색" 버튼 클릭
4. 결과 확인 및 "💾 저장" 버튼으로 저장

**저장 위치:**
- 로그인하지 않았으면: 브라우저 localStorage
- 로그인했으면: SQLite 데이터베이스

### 💰 2. 경제 뉴스 검색

**무엇을 하나요?**
- 최신 경제 뉴스를 자동으로 가져옵니다
- 중요도에 따라 별점을 표시합니다
- 최근 2주 이내의 뉴스만 보여줍니다
- 알람 기능으로 주기적으로 확인 가능합니다

**사용 방법:**
1. "경제 뉴스 검색" 버튼 클릭
2. 자동으로 최신 경제 뉴스 로드
3. 관심 있는 뉴스 클릭하여 저장
4. "🔔 경제뉴스 알람받기" 버튼으로 알람 설정

### 🎵 3. 음악 추천

**무엇을 하나요?**
- 좋아하는 노래를 입력하면 비슷한 노래를 추천합니다
- Last.fm API를 사용합니다
- 아티스트별로도 추천 가능합니다

**사용 방법:**
1. "음악 추천" 섹션에서 노래 제목 입력
2. 아티스트 이름 입력 (선택사항)
3. "추천받기" 버튼 클릭
4. 추천된 노래 확인

### 📻 4. 라디오 수집

**⚠️ 중요 안내:**
- **현재 표시되는 데이터는 실제 KBS 쿨FM, MBC FM4U, SBS 파워FM의 실시간 재생 정보가 아닙니다.**
- Last.fm의 **글로벌 인기 차트**를 표시하고 있습니다.
- 방송국별 실제 재생 정보를 얻으려면 해당 방송국의 공식 API가 필요합니다.
- 따라서 "현재 재생 중"이라고 표시되는 노래는 실제로 해당 방송국에서 재생 중인 것이 아닙니다.

**무엇을 하나요?**
- Last.fm 글로벌 인기 차트에서 인기 노래를 확인합니다 (실제 방송국 정보 아님)
- 최근 인기 노래 목록을 볼 수 있습니다
- 자동으로 히스토리에 저장됩니다

**사용 방법:**
1. "라디오 수집" 섹션 선택
2. 방송국 선택 (KBS/MBC/SBS) - 현재는 모두 같은 글로벌 차트를 표시
3. "현재 재생 중" 또는 "최근 재생" 버튼 클릭
4. 자동으로 히스토리에 저장됨

**참고:**
- 실제 한국 라디오 방송 정보를 얻으려면 해당 방송국의 공식 API가 필요합니다.
- 현재는 Last.fm의 `chart.getTopTracks` API를 사용하여 글로벌 인기 차트를 표시합니다.

### 📚 5. AI 도서 추천

**무엇을 하나요?**
- 사용자 입력을 AI가 분석하여 관련 도서를 추천합니다
- Google Books API를 사용합니다
- 카테고리별로 필터링 가능합니다
- 도서 상세 정보를 볼 수 있습니다

**🤖 AI 알고리즘 설명:**

**1. 키워드 분석 알고리즘:**
- **학습 키워드 감지**: "배우", "학습", "공부", "입문", "기초" 등 감지
- **주제 키워드 추출**: 머신러닝, 소설, 무협, 판타지 등 주제 자동 인식
- **작품 이름 감지**: 2-4글자 단일 단어는 작품 이름으로 인식
  - 예: "묵향" → 작품 이름으로 감지 → 해당 작품 제외하고 유사 장르 추천

**2. 작품 이름 처리 로직:**
- 작품 이름이 감지되면:
  - 해당 작품을 검색에서 제외 (`-작품이름`)
  - 유사한 장르(소설/판타지/무협)의 다른 작품 추천
  - 장르 관련성이 높은 도서 우선 정렬

**3. 관련성 점수 계산:**
- 제목에 키워드 포함: +3점
- 카테고리에 키워드 포함: +2점
- 설명에 키워드 포함: +1점
- 평점이 높은 도서 우선 정렬

**4. 정렬 알고리즘:**
1. 학습 키워드가 있으면 "입문", "기초" 포함 도서 우선
2. 추출된 키워드와 관련성 높은 도서 우선
3. 작품 이름이면 장르 관련성 높은 도서 우선
4. 평점이 높은 도서 우선
5. 상위 10개만 반환

**사용 방법:**
1. "AI 도서 추천" 섹션에서 원하는 도서에 대해 설명 입력
   - 예: "머신러닝을 처음 배우고 싶어요"
   - 예: "묵향" (작품 이름만 입력하면 유사 장르 추천)
   - 예: "재미있는 소설을 읽고 싶어요"
2. 카테고리 선택 (선택사항)
3. "🤖 AI 도서 추천 받기" 버튼 클릭
4. 원하는 책 "💾 저장" 버튼으로 저장

**API 엔드포인트:**
- `GET /api/books/recommend?query=키워드&category=카테고리`
- 이미 구현되어 있으며 외부에서도 사용 가능합니다

---

## 사용자 인증 및 관리

### 👤 회원가입

**왜 필요한가요?**
- 내가 찾은 뉴스, 음악, 책을 영구적으로 저장할 수 있습니다
- 저장한 데이터를 나중에 다시 볼 수 있습니다
- API 키를 생성해서 외부에서 API를 사용할 수 있습니다
- 여러 기기에서 같은 데이터에 접근할 수 있습니다

**사용 방법:**
1. 웹사이트 오른쪽 상단 "회원가입" 버튼 클릭
2. 이메일, 비밀번호(최소 6자), 이름 입력
3. "회원가입" 버튼 클릭
4. 자동으로 로그인됨

**저장되는 정보:**
- 이메일
- 비밀번호 (해시화되어 저장 - 안전!)
- 이름

### 🔐 로그인

**사용 방법:**
1. 웹사이트 오른쪽 상단 "로그인" 버튼 클릭
2. 이메일과 비밀번호 입력
3. "로그인" 버튼 클릭
4. 로그인 성공 시 JWT 토큰 발급 (자동 저장)

**로그인 후 할 수 있는 것:**
- 뉴스/음악/책 저장 (데이터베이스에 영구 저장)
- 프로필 수정
- API 키 생성 및 관리
- 저장한 데이터 조회

**이메일 입력 형식:**
- 일반 이메일 형식: `사용자명@도메인.com`
- 예시: `user@example.com`, `test@gmail.com`
- `@` 기호와 도메인 포함 필수
- 공백 없이 입력

**로그인 테스트 방법:**
프로젝트에 포함된 테스트 스크립트를 사용하여 로그인 기능을 테스트할 수 있습니다:

```bash
# 로그인 테스트 스크립트 실행
node test-login.js
```

**테스트 스크립트 기능:**
1. 데이터베이스 초기화 확인
2. 테스트 사용자 자동 생성 (없는 경우)
3. 로그인 API 테스트
4. 결과 출력 (성공/실패)

**테스트 스크립트 동작:**
- 자동으로 고유한 이메일 주소 생성 (`test{타임스탬프}@example.com`)
- 비밀번호: `test123`
- 회원가입 API를 통해 사용자 생성 후 로그인 테스트
- 서버 연결 상태 확인 및 오류 메시지 출력

### 👥 사용자 관리

**무엇을 할 수 있나요?**

**1. 프로필 탭**
- 이름 수정
- 이메일 수정
- 프로필 정보 저장

**2. 내 데이터 탭**
- 저장한 뉴스 목록 보기
- 저장한 라디오 노래 목록 보기
- 저장한 도서 목록 보기
- 데이터 개수 확인

**3. API 키 관리 탭**
- API 키 생성
- API 키 목록 보기
- API 키 활성화/비활성화
- API 키 삭제
- API 키 사용 방법 안내

**4. 계정 삭제 탭**
- 계정 완전 삭제
- 저장한 모든 데이터 삭제

**사용 방법:**
1. 로그인 후 "사용자 관리하기" 버튼 클릭
2. 원하는 탭 선택
3. 작업 수행

---

## API 키 사용 방법

### 🔑 API 키란?

**API 키는 외부에서 이 프로젝트의 API를 사용할 수 있게 해주는 열쇠**입니다.

**예를 들어:**
- 다른 프로그램에서 이 프로젝트의 뉴스 검색 기능을 사용하고 싶을 때
- Postman이나 curl로 API를 테스트하고 싶을 때
- 다른 서버에서 이 프로젝트의 API를 호출하고 싶을 때

### 📝 API 키 생성하기

1. 웹사이트에 로그인
2. "사용자 관리하기" → "API 키 관리" 탭
3. "➕ 새 API 키 생성" 버튼 클릭
4. 이름과 설명 입력 (선택사항)
5. 생성된 API 키를 안전한 곳에 저장 (**한 번만 표시됨!**)

**⚠️ 중요:**
- API 키는 `sk_`로 시작하는 긴 문자열입니다
- 생성 직후에만 전체 키를 볼 수 있습니다
- 잃어버리면 다시 생성해야 합니다

### 💻 API 키 사용 예제

**방법 1: X-API-Key 헤더 사용 (권장)**
```bash+
curl -H "X-API-Key: YOUR_API_KEY" \
  "http://localhost:3001/api/news?q=AI"
```

**방법 2: Authorization 헤더 사용**
```bash
curl -H "Authorization: ApiKey YOUR_API_KEY" \
  "http://localhost:3001/api/music/recommend?songTitle=Dynamite&artist=BTS"
```

**방법 3: 쿼리 파라미터 사용**
```bash
curl "http://localhost:3001/api/books/recommend?query=머신러닝&api_key=YOUR_API_KEY"
```

### 📚 사용 가능한 API 엔드포인트

**뉴스:**
- `GET /api/news?q=키워드` - 뉴스 검색
- `GET /api/news/economy?q=키워드` - 경제 뉴스 검색

**음악:**
- `GET /api/music/recommend?songTitle=제목&artist=아티스트` - 음악 추천
- `GET /api/music/radio/current?station=kbs&limit=5` - 현재 재생 중인 노래 (⚠️ 실제 방송국 정보 아님, Last.fm 글로벌 차트)
- `GET /api/music/radio/recent?station=kbs&limit=10` - 최근 재생된 노래 (⚠️ 실제 방송국 정보 아님, Last.fm 글로벌 차트)

**도서:**
- `GET /api/books/search?q=키워드&maxResults=10` - 도서 검색
- `GET /api/books/recommend?query=키워드&category=computers` - 도서 추천

**사용자 데이터 (인증 필수):**
- `POST /api/user/news` - 뉴스 저장
- `POST /api/user/radio-songs` - 라디오 노래 저장
- `POST /api/user/books` - 도서 저장
- `GET /api/user/profile` - 프로필 조회
- `PUT /api/user/profile` - 프로필 수정
- `GET /api/user/data` - 저장한 데이터 조회
- `DELETE /api/user/account` - 계정 삭제

**API 키 관리 (인증 필수):**
- `POST /api/api-keys` - API 키 생성
- `GET /api/api-keys` - API 키 목록 조회
- `DELETE /api/api-keys/:id` - API 키 삭제
- `PUT /api/api-keys/:id/toggle` - API 키 활성화/비활성화

### 🌐 Swagger UI로 테스트하기

**Swagger UI는 API를 쉽게 테스트할 수 있는 웹 인터페이스**입니다.

1. 브라우저에서 `http://localhost:3001/api-docs` 접속
2. 상단 "Authorize" 버튼 클릭
3. **ApiKeyAuth** 필드에 API 키 입력 (외부에서 호출할 때)
   또는 **BearerAuth** 필드에 JWT 토큰 입력 (웹 앱 개발 시)
4. "Authorize" 클릭
5. 원하는 API 엔드포인트 선택하여 테스트

**💡 팁:**
- 외부에서 API를 테스트할 때는 **ApiKeyAuth만** 사용하면 됩니다
- 웹 앱 개발 시에는 **BearerAuth** (JWT 토큰)를 사용합니다
- 둘 다 입력할 필요 없습니다!

### 🔒 API 키 보안

**안전하게 사용하는 방법:**
- API 키를 코드에 직접 작성하지 마세요
- 환경 변수나 설정 파일에 저장하세요
- Git에 커밋하지 마세요 (`.gitignore`에 추가)
- 정기적으로 API 키를 교체하세요
- 사용하지 않는 API 키는 삭제하세요

---

## MCP 서버 설정

### 🤔 MCP 서버란?

**MCP (Model Context Protocol) 서버는 Cursor AI와 대화할 수 있게 해주는 서버**입니다.

**예를 들어:**
- Cursor AI에게 "5와 7을 더해줘"라고 하면
- MCP 서버가 `add_numbers` 도구를 사용하여 12를 반환합니다

- Cursor AI에게 "머신러닝 관련 책 추천해줘"라고 하면
- MCP 서버가 `recommend_books` 도구를 사용하여 책 목록을 반환합니다

### 🐍 Python MCP 서버 설정

**1. Cursor 설정 파일 수정**

`cursor-mcp-config.json` 파일을 열고 다음 내용 확인:

```json
{
  "mcpServers": {
    "unified-mcp-server": {
      "command": "python",
      "args": ["mcp-unified-server.py"],
      "cwd": "C:/test/test02"
    }
  }
}
```

**경로 확인:**
- `cwd`는 프로젝트 폴더의 절대 경로입니다
- Windows: `C:/test/test02`
- Mac/Linux: `/Users/username/projects/test02`

**2. Cursor 재시작**

Cursor를 완전히 종료하고 다시 실행하면 MCP 서버가 자동으로 연결됩니다.

**3. 사용 가능한 기능**

**Python MCP 서버 (`mcp-unified-server.py`):**
- `add_numbers`: 두 숫자 더하기
- `recommend_books`: 도서 추천
- `get_popular_books`: 인기 도서 조회
- `get_book_details`: 도서 상세 정보 조회

**Node.js MCP 서버 (`mcp-server.js`):**
- `search_ai_articles`: AI 기사 검색
- `get_radio_song`: 라디오 현재 재생 노래
- `get_radio_recent_songs`: 라디오 최근 재생 노래
- `recommend_similar_songs`: 유사한 노래 추천

### 📝 MCP 서버 사용 예제

**Cursor AI 채팅에서 실제 사용 예시:**

```
"5와 7을 더해줘"
→ add_numbers 도구 사용
→ 결과: 12

"ChatGPT에 대한 최신 뉴스를 찾아줘"
→ search_ai_articles 도구 사용
→ 결과: ChatGPT 관련 최신 AI 기사 목록 및 링크

"인공지능 관련 책을 추천해줘"
→ recommend_books 도구 사용
→ 결과: 인공지능 관련 도서 추천 목록

"사용 가능한 MCP 도구 목록을 보여줘"
→ 모든 도구 목록 표시
→ 결과: Python MCP 서버 및 Node.js MCP 서버의 모든 도구 목록
```

**더 많은 예시:**

```
"머신러닝 관련 책 추천해줘"
→ recommend_books 도구 사용
→ 결과: 머신러닝 관련 도서 목록

"인기 도서 목록 보여줘"
→ get_popular_books 도구 사용
→ 결과: 인기 도서 목록

"KBS 라디오에서 지금 재생 중인 노래 알려줘"
→ get_radio_song 도구 사용 (station: kbs)
→ 결과: 현재 재생 중인 노래 정보

"BTS의 Dynamite와 비슷한 노래 추천해줘"
→ recommend_similar_songs 도구 사용
→ 결과: 유사한 노래 추천 목록
```

### 🔧 MCP 서버 실행 방법

**Python MCP 서버:**
```bash
python mcp-unified-server.py
```

**Node.js MCP 서버:**
```bash
npm run mcp-server
```

**자동 빌드 및 실행:**
```bash
build-and-run-mcp.bat  # Windows
build-and-run-mcp.sh   # Mac/Linux
```

---

## 데이터 저장 위치

### 💾 데이터는 어디에 저장되나요?

**1. 브라우저 localStorage (임시 저장)**

**위치:** 브라우저 내부 저장소  
**용도:** 로그인하지 않아도 뉴스/음악/책을 임시로 저장  
**특징:**
- 브라우저를 닫아도 유지됨
- 브라우저 데이터 삭제하면 사라짐
- 브라우저별로 독립적으로 저장됨

**저장되는 데이터:**
- `newsHistory`: 저장한 뉴스 목록
- `radioSongsHistory`: 저장한 라디오 노래 목록
- `booksHistory`: 저장한 도서 목록

**2. SQLite 데이터베이스 (영구 저장)**

**위치:** `C:\test\test02\data\database.db` (Windows)  
**용도:** 로그인한 사용자의 데이터 영구 저장  
**특징:**
- 파일로 저장되어 영구 보존
- 여러 기기에서 접근 가능 (서버에 저장)
- 데이터베이스 파일 삭제 전까지 유지

**저장되는 데이터:**

**users 테이블:**
- 사용자 ID
- 이메일
- 비밀번호 해시
- 이름
- 생성일

**news 테이블:**
- 뉴스 ID
- 사용자 ID
- 제목
- 설명
- URL
- 출처
- 발행일
- 저장일

**radioSongs 테이블:**
- 노래 ID
- 사용자 ID
- 제목
- 아티스트
- 방송국
- 재생 시간
- 저장일

**books 테이블:**
- 도서 ID
- 사용자 ID
- 제목
- 저자
- 출판사
- 설명
- ISBN
- 저장일

**apiKeys 테이블:**
- API 키 ID
- 사용자 ID
- API 키
- 이름
- 설명
- 활성화 여부
- 마지막 사용 시간
- 생성일
- 만료일

**apiKeyUsage 테이블:**
- 사용 이력 ID
- API 키 ID
- 엔드포인트
- HTTP 메서드
- IP 주소
- User Agent
- 상태 코드
- 생성일

### 🔍 데이터베이스 확인 방법

**방법 1: 파일 확인**
```
C:\test\test02\data\database.db 파일이 생성되어 있으면 정상입니다!
```

**방법 2: 웹사이트에서 확인**
1. 로그인 후 "사용자 관리하기" 클릭
2. "내 데이터" 탭에서 저장한 데이터 확인

**방법 3: SQLite 도구 사용**
- DB Browser for SQLite 다운로드
- `data/database.db` 파일 열기
- 테이블 및 데이터 확인

**방법 4: 웹사이트에서 스키마 확인 (권장)**
1. 로그인 후 "사용자 관리하기" 클릭
2. "📊 DB 스키마" 탭 선택
3. 모든 테이블과 컬럼 정보를 시각적으로 확인 가능
4. 각 컬럼의 타입, NULL 허용 여부, 기본값, Primary Key 여부 확인 가능

### 📊 데이터베이스 스키마 조회 기능

**무엇을 하나요?**
- 데이터베이스에 구성된 모든 테이블과 컬럼 정보를 조회합니다
- 각 컬럼의 데이터 타입, 제약 조건, 기본값 등을 확인할 수 있습니다
- 웹 UI에서 시각적으로 확인 가능합니다

**사용 방법:**
1. 로그인 후 "사용자 관리하기" 버튼 클릭
2. "📊 DB 스키마" 탭 선택
3. 자동으로 스키마 정보가 로드됩니다
4. 테이블별로 컬럼 정보를 확인할 수 있습니다

**스키마 조회 로직 설명:**

**1. 프론트엔드 (src/App.vue)**
- 사용자가 "DB 스키마" 탭을 클릭하면 `loadDbSchema()` 함수가 실행됩니다
- `GET http://localhost:3001/api/db/schema` API를 호출합니다
- 응답 데이터를 받아 화면에 표시합니다
- 오류 발생 시 상세한 오류 메시지와 디버깅 정보를 표시합니다

**2. 백엔드 API (api-server.js)**
- `/api/db/schema` 엔드포인트가 요청을 받습니다
- `database.js`의 `getSchema()`와 `getTables()` 함수를 호출합니다
- 스키마 정보를 JSON 형식으로 반환합니다
- 오류 발생 시 상세한 오류 메시지와 스택 트레이스를 로그에 기록합니다

**3. 데이터베이스 레이어 (database.js)**

**`getSchema()` 함수:**
- 데이터베이스가 초기화되었는지 확인합니다
- 모든 테이블(`users`, `news`, `radioSongs`, `books`, `apiKeys`, `apiKeyUsage`)에 대해 반복합니다
- 각 테이블의 `CREATE TABLE` 문을 `sqlite_master` 테이블에서 조회합니다
- `parseTableSchema()` 함수로 `CREATE TABLE` 문을 파싱하여 컬럼 정보를 추출합니다
- 파싱 실패 시 `getDefaultSchema()` 함수로 기본 스키마 정보를 반환합니다

**`parseTableSchema()` 함수:**
- `CREATE TABLE` SQL 문을 파싱합니다
- 정규식을 사용하여 컬럼 정의 부분을 추출합니다
- 각 컬럼의 이름, 타입, NOT NULL 여부, PRIMARY KEY 여부, 기본값을 추출합니다
- FOREIGN KEY 제약 조건은 제외합니다 (컬럼 정보만 추출)

**`getDefaultSchema()` 함수:**
- 파싱 실패 시 사용되는 폴백 함수입니다
- 각 테이블의 기본 스키마 정보를 하드코딩된 배열로 반환합니다
- 모든 테이블의 기본 스키마 정보를 포함합니다

**`getTables()` 함수:**
- `sqlite_master` 테이블에서 모든 테이블 이름을 조회합니다
- 테이블 이름을 배열로 반환합니다

**왜 이렇게 구현했나요?**
- `sql.js` 라이브러리는 SQLite의 `PRAGMA table_info` 명령을 완벽하게 지원하지 않습니다
- 따라서 `CREATE TABLE` 문을 직접 파싱하는 방식을 사용합니다
- 파싱 실패 시를 대비해 기본 스키마 정보를 제공합니다

**오류 처리:**
- 데이터베이스가 초기화되지 않은 경우 빈 객체/배열 반환
- 테이블이 없는 경우 빈 배열 반환
- 파싱 오류 발생 시 기본 스키마 정보 반환
- 모든 오류는 콘솔에 로그로 기록됩니다

**API 응답 형식:**
```json
{
  "success": true,
  "tables": ["users", "news", "radioSongs", "books", "apiKeys", "apiKeyUsage"],
  "schema": {
    "users": [
      {
        "cid": 0,
        "name": "id",
        "type": "INTEGER",
        "notnull": true,
        "dflt_value": null,
        "pk": true
      },
      {
        "cid": 1,
        "name": "email",
        "type": "TEXT",
        "notnull": true,
        "dflt_value": null,
        "pk": false
      }
      // ... 더 많은 컬럼
    ],
    "news": [ /* ... */ ],
    // ... 더 많은 테이블
  }
}
```

### 📊 데이터 저장 흐름

**로그인하지 않은 경우:**
```
사용자가 "💾 저장" 클릭
  ↓
localStorage에 저장
  ↓
브라우저에만 저장됨
```

**로그인한 경우:**
```
사용자가 "💾 저장" 클릭
  ↓
localStorage에 저장 (임시)
  ↓
백엔드 API 호출 (/api/user/news 등)
  ↓
SQLite 데이터베이스에 저장 (영구)
  ↓
두 곳에 모두 저장됨!
```

---

## 문제 해결

### ❌ 문제 1: 서버가 시작되지 않아요

**증상:**
- `start-dev.bat` 실행 시 오류 발생
- 포트가 이미 사용 중이라는 메시지

**해결 방법:**
1. 포트가 이미 사용 중인지 확인
   ```bash
   netstat -ano | findstr :3001
   netstat -ano | findstr :5173
   netstat -ano | findstr :3002
   ```
2. 다른 프로그램이 포트를 사용 중이면 종료
3. 서버를 다시 시작

### ❌ 문제 2: "npm install" 오류가 나요

**증상:**
- 패키지 설치 실패
- 네트워크 오류

**해결 방법:**
1. Node.js가 설치되어 있는지 확인
   ```bash
   node --version
   ```
2. npm 캐시 삭제 후 재시도
   ```bash
   npm cache clean --force
   npm install
   ```
3. 네트워크 연결 확인
4. 프록시 설정 확인 (필요한 경우)

### ❌ 문제 3: Python 패키지 설치 오류

**증상:**
- `pip install` 실패
- 패키지를 찾을 수 없음

**해결 방법:**
1. Python이 설치되어 있는지 확인
   ```bash
   python --version
   ```
2. pip 업그레이드
   ```bash
   python -m pip install --upgrade pip
   ```
3. 패키지 재설치
   ```bash
   pip install mcp playwright
   ```
4. Playwright 브라우저 설치
   ```bash
   playwright install chromium
   ```

### ❌ 문제 4: 데이터베이스 오류

**증상:**
- 데이터베이스 파일을 찾을 수 없음
- 데이터 저장 실패

**해결 방법:**
1. `data` 폴더가 있는지 확인
2. 없으면 생성:
   ```bash
   mkdir data
   ```
3. API 서버 재시작 (자동으로 데이터베이스 생성됨)
4. 파일 권한 확인

### ❌ 문제 5: API 호출이 안 돼요

**증상:**
- 뉴스/음악/책 검색 실패
- 404 또는 500 오류

**해결 방법:**
1. API 서버가 실행 중인지 확인 (포트 3001)
2. `.env` 파일에 API 키가 있는지 확인
3. 브라우저 개발자 도구(F12)에서 오류 메시지 확인
4. 네트워크 탭에서 요청/응답 확인

### ❌ 문제 6: 한글이 깨져요

**증상:**
- 배치 파일 실행 시 한글 깨짐
- 터미널에서 한글 표시 오류

**해결 방법:**
1. 배치 파일은 UTF-8로 저장되어 있어야 합니다
2. 명령 프롬프트에서 `chcp 65001` 실행 후 재시도
3. PowerShell 사용 권장

### ❌ 문제 7: 로그인이 안 돼요

**증상:**
- 로그인 버튼 클릭 시 오류
- "인증이 필요합니다" 메시지
- "이메일 또는 비밀번호가 올바르지 않습니다" 오류

**해결 방법:**
1. 이메일과 비밀번호가 올바른지 확인
   - 이메일 형식 확인 (`@` 포함)
   - 비밀번호 대소문자 구분 확인
2. 회원가입이 완료되었는지 확인
   - 회원가입 페이지에서 새 계정 생성
3. API 서버가 실행 중인지 확인
   ```bash
   netstat -ano | findstr :3001
   ```
4. 브라우저 개발자 도구에서 오류 메시지 확인
5. 로그인 테스트 스크립트로 확인
   ```bash
   node test-login.js
   ```
   - 스크립트가 성공하면 로그인 기능은 정상 작동 중
   - 실패하면 서버 로그 확인 필요

**로그인 테스트 스크립트 사용법:**
- `test-login.js` 파일이 프로젝트 루트에 있습니다
- 자동으로 테스트 사용자를 생성하고 로그인을 시도합니다
- 서버 연결 오류 시 명확한 오류 메시지를 출력합니다

### ❌ 문제 8: API 키가 작동하지 않아요

**증상:**
- API 키로 인증 실패
- "유효하지 않은 API 키" 오류

**해결 방법:**
1. API 키가 올바르게 복사되었는지 확인
2. API 키가 활성화되어 있는지 확인 (사용자 관리에서 확인)
3. API 키가 만료되지 않았는지 확인
4. 올바른 헤더 형식 사용 확인 (X-API-Key 또는 Authorization)

### ❌ 문제 9: MCP 서버가 연결되지 않아요

**증상:**
- Cursor AI에서 MCP 기능 사용 불가
- MCP 서버 오류 메시지

**해결 방법:**
1. `cursor-mcp-config.json` 파일 경로 확인
2. Python이 설치되어 있는지 확인
3. 필요한 패키지 설치 확인 (`pip install mcp`)
4. Cursor 완전히 재시작
5. MCP 서버를 수동으로 실행하여 오류 확인

---

## 📞 추가 도움말

### 📚 관련 문서

- **API 문서**: `http://localhost:3001/api-docs` (Swagger UI)
- **프로젝트 README**: `README.md`

### 🔗 외부 API 문서

- **News API**: https://newsapi.org/docs
- **Last.fm API**: https://www.last.fm/api
- **Google Books API**: https://developers.google.com/books
- **MCP 프로토콜**: https://modelcontextprotocol.io

### 🛠️ 유용한 명령어

```bash
# 서버 실행
start-dev.bat                    # 모든 서버 실행
npm run api-server               # API 서버만 실행
npm run dev                      # 프론트엔드만 실행

# MCP 서버 실행
python mcp-unified-server.py     # Python MCP 서버
npm run mcp-server               # Node.js MCP 서버

# 로그인 테스트
node test-login.js              # 로그인 기능 테스트 스크립트 실행

# 데이터베이스 확인
# data/database.db 파일 확인
```

---

## ✅ 체크리스트

프로젝트를 처음 시작할 때 확인할 사항:

- [ ] Node.js 설치됨 (`node --version`)
- [ ] Python 설치됨 (`python --version`)
- [ ] `npm install` 완료
- [ ] `pip install mcp playwright` 완료
- [ ] `playwright install chromium` 완료
- [ ] `.env` 파일 생성 (API 키 설정)
- [ ] `start-dev.bat` 실행 성공
- [ ] `http://localhost:5173` 접속 성공
- [ ] 회원가입/로그인 테스트 성공
- [ ] 뉴스 검색 테스트 성공
- [ ] API 키 생성 테스트 성공

---

**마지막 업데이트**: 2025년 1월

---

## 🔄 최근 변경사항 (2025년 1월)

### 코드 구조 개선 진행 중
- ✅ 유틸리티 함수 분리 (`src/utils/helpers.js`)
- ✅ API 서비스 레이어 생성 (`src/services/`)
- ✅ 컴포넌트 구조 개선 진행 중
- 📝 자세한 내용: [`코드_구조_개선_계획.md`](./코드_구조_개선_계획.md)

### 로그인 기능 개선
- ✅ 로그인 테스트 스크립트 추가 (`test-login.js`)
- ✅ 이메일 입력 형식 가이드 추가
- ✅ 로그인 문제 해결 방법 보완
- ✅ 자동 테스트 사용자 생성 기능

### 데이터베이스 스키마 조회 기능 추가
- ✅ 웹 UI에서 데이터베이스 스키마 확인 기능 추가
- ✅ `/api/db/schema` API 엔드포인트 구현
- ✅ `CREATE TABLE` 문 파싱 로직 구현
- ✅ 상세한 오류 처리 및 디버깅 정보 제공
- ✅ 가이드 문서에 스키마 조회 로직 설명 추가

**프로젝트 버전**: 0.0.0

**이 가이드가 도움이 되었다면 ⭐를 눌러주세요!**
