# 📚 프로젝트 완전 가이드

> **AI 기반 뉴스/음악/도서 추천 및 SQL 쿼리 분석 시스템**

**마지막 업데이트**: 2025년 1월  
**프로젝트 버전**: 0.0.0

---

## 📋 목차

1. [프로젝트 개요](#프로젝트-개요)
2. [빠른 시작](#빠른-시작)
3. [주요 기능](#주요-기능)
4. [프로젝트 구조](#프로젝트-구조)
5. [서버 포트 및 실행](#서버-포트-및-실행)
6. [SQL 쿼리 분석 기능](#sql-쿼리-분석-기능)
7. [사용자 인증 및 관리](#사용자-인증-및-관리)
8. [API 키 사용](#api-키-사용)
9. [MCP 서버 설정](#mcp-서버-설정)
10. [Docker 배포](#docker-배포)
11. [문제 해결](#문제-해결)

---

## 프로젝트 개요

### 🎯 프로젝트 이름
**AI 기반 뉴스/음악/도서 추천 및 SQL 쿼리 분석 시스템**

### 📖 주요 기능
- ✅ **SQL 쿼리 분석**: PostgreSQL 쿼리 자동 분석 및 리니지 시각화
- ✅ **AI 뉴스 검색**: 키워드 기반 AI 관련 뉴스 검색 및 분석
- ✅ **경제 뉴스 검색**: 최신 경제 뉴스 자동 검색 및 중요도 분석
- ✅ **음악 추천**: Last.fm API를 활용한 음악 추천
- ✅ **라디오 수집**: 실시간 라디오 방송 노래 수집 및 현황 관리
- ✅ **도서 추천**: Google Books API를 활용한 도서 검색 및 추천
- ✅ **사용자 인증**: 회원가입, 로그인, JWT 토큰 기반 인증
- ✅ **API 키 인증**: 외부에서 API를 사용할 수 있는 API 키 시스템
- ✅ **MCP 서버**: Cursor AI에서 사용 가능한 MCP 서버 제공

---

## 빠른 시작

### 1. 의존성 설치

```bash
# Node.js 패키지
npm install

# Python 패키지
pip install -r requirements.txt
```

### 2. 환경 변수 설정

`.env` 파일을 생성하고 API 키를 설정하세요:

```env
NEWS_API_KEY=your_news_api_key_here
LASTFM_API_KEY=your_lastfm_api_key_here
JWT_SECRET=your_secret_key_here
JWT_EXPIRES_IN=7d
```

### 3. 모든 서버 실행

**Windows (권장):**
```bash
start-dev.bat
```

이 명령어 하나로 다음 서버들이 자동으로 실행됩니다:
- ✅ API 서버 (포트 3001)
- ✅ Python HTTP 서버 (포트 3002)
- ✅ Vite 개발 서버 (포트 5173)

**서버 종료:**
```bash
stop-all-servers.bat
```

### 4. 브라우저 접속

```
http://localhost:5173
```

---

## 주요 기능

### 🔍 SQL 쿼리 분석 (신규 기능)

**무엇을 하나요?**
- PostgreSQL 쿼리를 자동으로 분석하여 구조, 성능, 복잡도, 보안을 평가
- 데이터 리니지(데이터 흐름) 분석 및 시각화
- 최적화 제안 제공
- JSON 및 마크다운 리포트 생성
- 영향도 분석 기능 (특정 테이블/컬럼 변경 시 영향 범위 분석)

**사용 방법:**
1. 웹사이트에서 "SQL 쿼리 분석" 섹션 선택
2. SQL 파일 경로 입력 (예: `queries/complex_query.sql`) 또는 SQL 쿼리 직접 입력
3. "AI 쿼리 분석하기" 버튼 클릭
4. 분석 결과 확인 및 리니지 시각화 보기

**지원하는 쿼리:**
- SELECT, INSERT, UPDATE, DELETE
- CREATE (DDL)
- 멀티 쿼리 (세미콜론으로 구분)

**분석 항목:**
- 쿼리 구조 분석 (테이블, 컬럼, JOIN, 서브쿼리, CTE)
- 성능 분석 (인덱스 사용, 풀 스캔 위험도)
- 복잡도 분석 (중첩도, 테이블 수)
- 보안 분석 (SQL Injection 취약점)
- 최적화 제안 (인덱스 제안, 쿼리 리팩토링)
- 데이터 리니지 분석 (테이블 간 관계 시각화)

**화면 출력 내용:**

#### 1. 실행 요약 (Analysis Summary)
- **쿼리 타입**: SELECT, INSERT, UPDATE 등
- **테이블 수**: 쿼리에서 사용된 테이블 개수
- **JOIN 수**: JOIN 관계 개수
- **서브쿼리 수**: 중첩된 서브쿼리 개수
- **CTE 수**: Common Table Expression 개수

#### 2. 쿼리 구조 분석 (Query Structure)
- **테이블 목록**: 쿼리에서 참조하는 모든 테이블 목록
- **컬럼 목록**: SELECT 절에서 사용된 컬럼 목록
- **JOIN 관계**: 테이블 간 JOIN 관계 및 타입 (INNER, LEFT, RIGHT 등)
- **서브쿼리 정보**: 서브쿼리 위치 및 깊이
- **CTE 정보**: CTE 이름 및 쿼리 내용

#### 3. 성능 분석 (Performance Analysis)
- **성능 점수**: 0-100점 (높을수록 좋음)
- **성능 레벨**: EXCELLENT, GOOD, FAIR, POOR, CRITICAL
- **이슈 목록**:
  - 인덱스 미사용 경고
  - 풀 테이블 스캔 위험
  - 비효율적인 JOIN 순서
  - N+1 쿼리 패턴
- **권장사항**: 성능 개선을 위한 구체적인 제안

#### 4. 복잡도 분석 (Complexity Analysis)
- **복잡도 점수**: 0-100점 (낮을수록 단순)
- **복잡도 레벨**: SIMPLE, MODERATE, COMPLEX, VERY_COMPLEX
- **메트릭**:
  - 쿼리 길이 (라인 수)
  - 테이블 수
  - JOIN 수
  - 서브쿼리 깊이
  - WHERE 절 복잡도

#### 5. 보안 분석 (Security Analysis)
- **보안 점수**: 0-100점 (높을수록 안전)
- **보안 레벨**: SAFE, LOW, MEDIUM, HIGH, CRITICAL
- **취약점 목록**:
  - SQL Injection 취약점
  - 문자열 연결 사용
  - 동적 쿼리 생성
  - 과도한 권한 사용
  - 데이터 노출 위험

#### 6. 최적화 제안 (Optimization Suggestions)
- **인덱스 제안**: 성능 향상을 위한 인덱스 추가 제안
- **쿼리 리팩토링**: 쿼리 구조 개선 제안
- **JOIN 최적화**: JOIN 순서 및 방법 최적화
- **집계 최적화**: GROUP BY, HAVING 절 최적화
- **예상 개선 효과**: 각 제안의 예상 성능 개선률

#### 7. 데이터 리니지 (Data Lineage)
- **테이블 목록**: 쿼리에서 사용된 모든 테이블 (드롭다운으로 표시)
- **CTE 목록**: 정의된 모든 CTE
- **JOIN 관계**: 테이블 간 JOIN 관계 (51개 관계 예시)
- **CTE 의존성**: CTE가 참조하는 테이블 관계
- **서브쿼리 관계**: 서브쿼리와 메인 쿼리의 관계

#### 8. 리니지 시각화 (Lineage Visualization)
- **인터랙티브 네트워크 그래프**: 
  - 테이블을 노드로 표시
  - JOIN 관계를 엣지(선)로 표시
  - 노드 클릭 시 해당 테이블의 영향도 분석 자동 실행
  - 드래그하여 그래프 이동 및 확대/축소 가능
- **테이블 관계 그래프**:
  - 시각적 테이블 관계 표현
  - CTE는 "(CTE)" 표시로 구분
  - 색상으로 테이블 타입 구분

#### 9. 영향도 분석 (Impact Analysis) - 신규 기능
- **분석 대상**: 특정 테이블 또는 컬럼 선택
- **직접 영향 (Direct Impacts)**:
  - FROM 절에서 사용된 위치
  - JOIN 조건에서 사용된 위치
  - WHERE 절에서 사용된 위치
  - SELECT 절에서 사용된 위치
- **간접 영향 (Indirect Impacts)**:
  - JOIN 관계를 통한 영향
  - CTE 의존성을 통한 영향
  - 서브쿼리 관계를 통한 영향
- **영향받는 테이블 목록**: 변경 시 영향받는 모든 테이블
- **영향받는 CTE 목록**: 변경 시 영향받는 모든 CTE
- **영향도 점수**: 0-100점 (높을수록 영향 큼)
- **영향도 레벨**: LOW, MEDIUM, HIGH, CRITICAL
- **권장사항**: 변경 시 주의사항 및 검토 항목

**리니지 시각화 화면 구성:**
```
┌─────────────────────────────────────────┐
│  📊 데이터 리니지 시각화                │
├─────────────────────────────────────────┤
│                                         │
│    [테이블1] ──JOIN── [테이블2]        │
│      │                    │             │
│      └──JOIN── [테이블3]  │             │
│                           │             │
│                    [CTE1] (CTE)         │
│                                         │
│  - 노드 클릭 시 영향도 분석 실행        │
│  - 드래그하여 그래프 이동              │
│  - 마우스 휠로 확대/축소                │
└─────────────────────────────────────────┘
```

**Python으로 직접 실행:**
```bash
# 기본 분석
python analyze-sql.py queries/complex_query.sql

# 영향도 분석
python test-sql-query-analyzer.py --impact --target_table users queries/complex_query.sql

# 비교 분석 (PostgreSQL EXPLAIN ANALYZE와 비교)
python compare_sql_analyzers.py queries/complex_query_500.sql
```

### 📰 AI 뉴스 검색

**무엇을 하나요?**
- 키워드를 입력하면 AI 관련 뉴스를 검색
- 최근 일주일 이내의 뉴스만 표시
- 키워드 간의 관계를 그래프로 시각화
- 뉴스를 저장할 수 있음

**사용 방법:**
1. "AI 뉴스 검색" 섹션에서 검색어 입력 (예: "ChatGPT")
2. "검색" 버튼 클릭
3. 결과 확인 및 "💾 저장" 버튼으로 저장

### 💰 경제 뉴스 검색

**무엇을 하나요?**
- 최신 경제 뉴스를 자동으로 가져옴
- 중요도에 따라 별점 표시
- 최근 2주 이내의 뉴스만 표시
- 알람 기능으로 주기적으로 확인 가능

**사용 방법:**
1. "경제 뉴스 검색" 버튼 클릭
2. 자동으로 최신 경제 뉴스 로드
3. 관심 있는 뉴스 클릭하여 저장

### 🎵 음악 추천

**무엇을 하나요?**
- 좋아하는 노래를 입력하면 비슷한 노래를 추천
- Last.fm API 사용
- 아티스트별로도 추천 가능

**사용 방법:**
1. "음악 추천" 섹션에서 노래 제목 입력
2. 아티스트 이름 입력 (선택사항)
3. "추천받기" 버튼 클릭

### 📻 라디오 수집

**무엇을 하나요?**
- Last.fm 글로벌 인기 차트에서 인기 노래 확인
- 최근 인기 노래 목록 제공
- 자동으로 히스토리에 저장

**사용 방법:**
1. "라디오 수집" 섹션 선택
2. 방송국 선택 (KBS/MBC/SBS)
3. "현재 재생 중" 또는 "최근 재생" 버튼 클릭

### 📚 도서 추천

**무엇을 하나요?**
- Google Books API를 활용한 도서 검색 및 추천
- 키워드나 장르로 검색 가능
- 인기 도서 목록 제공

**사용 방법:**
1. "도서 추천" 섹션에서 키워드 입력
2. "검색" 버튼 클릭
3. 추천된 도서 확인

---

## 프로젝트 구조

```
test02/
├── src/                          # Vue 프론트엔드
│   ├── App.vue                   # 메인 화면
│   ├── components/               # 컴포넌트
│   │   ├── features/             # 기능별 컴포넌트
│   │   ├── modals/               # 모달 컴포넌트
│   │   ├── LoginModal.vue        # 로그인 모달
│   │   └── SignupModal.vue       # 회원가입 모달
│   ├── services/                 # API 서비스 레이어
│   │   ├── api.js                # 기본 API 호출 함수
│   │   └── newsService.js        # 뉴스 관련 API 서비스
│   ├── stores/                   # 상태 관리
│   │   └── auth.js               # 인증 상태 관리
│   ├── utils/                    # 유틸리티 함수
│   │   └── helpers.js            # 공통 헬퍼 함수
│   └── style.css                 # 스타일
├── api-server.js                 # 백엔드 API 서버 (포트 3001)
├── database.js                   # SQLite 데이터베이스 관리
├── mcp-unified-server.py         # 통합 MCP 서버 (Python)
├── mcp-server.js                 # Node.js MCP 서버
├── mcp-sql-query-analyzer.py     # SQL 쿼리 분석 MCP 서버
├── generate_lineage_visualization.py  # 리니지 시각화 생성
├── analyze-sql.py                # SQL 분석 직접 실행 스크립트
├── test-sql-query-analyzer.py    # SQL 분석 테스트 스크립트
├── queries/                      # SQL 쿼리 파일들
│   ├── complex_query_500.sql
│   ├── complex_query_750.sql
│   ├── complex_query_2000.sql
│   └── sql_analysis/             # 분석 결과 저장 폴더
├── start-dev.bat                 # 개발 환경 실행
├── stop-all-servers.bat          # 모든 서버 종료
├── data/                         # 데이터 저장소
│   └── database.db               # SQLite 데이터베이스
└── docs/                         # 문서 폴더
    ├── SQL_쿼리_분석_MCP_서버_가이드.md
    └── Docker_빌드_배포_가이드.md
```

---

## 서버 포트 및 실행

| 서버 | 포트 | 실행 명령어 | 설명 |
|------|------|------------|------|
| API 서버 | 3001 | `npm run api-server` | 백엔드 API 서버 |
| Python HTTP 서버 | 3002 | `npm run screen-validator-server` | Python HTTP 서버 |
| Vite 개발 서버 | 5173 | `npm run dev` | 프론트엔드 개발 서버 |

### 서버 실행 방법

**자동 실행 (권장):**
```bash
start-dev.bat
```

**수동 실행:**
```bash
# 각 서버를 별도 터미널에서 실행
npm run api-server              # 터미널 1
npm run screen-validator-server # 터미널 2
npm run dev                     # 터미널 3
```

**모든 서버 종료:**
```bash
stop-all-servers.bat
```

---

## SQL 쿼리 분석 기능

### 웹 인터페이스 사용

1. **브라우저에서 접속**: `http://localhost:5173`
2. **SQL 쿼리 분석 섹션 선택**
3. **SQL 입력 방법 선택**:
   - 파일 경로 입력: `queries/complex_query.sql`
   - 또는 SQL 쿼리 직접 입력
4. **"AI 쿼리 분석하기" 버튼 클릭**
5. **분석 진행 상황 확인**:
   - 프로그레스 바로 분석 진행률 표시
   - 리니지 시각화 생성 중 표시 (50% → 100%)
6. **분석 결과 확인**:
   - **실행 요약**: 쿼리 타입, 테이블 수, JOIN 수 등
   - **쿼리 구조 분석**: 테이블 목록, 컬럼 목록, JOIN 관계
   - **성능 분석**: 성능 점수, 이슈 목록, 권장사항
   - **복잡도 분석**: 복잡도 점수, 메트릭 상세
   - **보안 분석**: 보안 점수, 취약점 목록
   - **최적화 제안**: 인덱스 제안, 쿼리 리팩토링 제안
   - **데이터 리니지**: 테이블 목록, CTE 목록, JOIN 관계 (51개 관계 예시)
7. **리니지 시각화 보기**: 
   - "🌐 리니지 시각화 보기" 버튼 클릭
   - 인터랙티브 네트워크 그래프 표시
   - 테이블 노드 클릭 시 영향도 분석 자동 실행
8. **영향도 분석 사용**:
   - 테이블 선택 드롭다운에서 테이블 선택
   - 컬럼명 입력 (선택사항)
   - "영향도 분석하기" 버튼 클릭
   - 직접/간접 영향 범위 확인
9. **리포트 다운로드**: JSON 또는 마크다운 형식으로 다운로드

### 화면 구성 예시

```
┌─────────────────────────────────────────────────┐
│  📊 SQL 쿼리 분석 결과                          │
├─────────────────────────────────────────────────┤
│  실행 요약                                      │
│  ┌─────────────────────────────────────────┐   │
│  │ 쿼리 타입: SELECT                       │   │
│  │ 테이블 수: 18개                          │   │
│  │ JOIN 수: 51개                            │   │
│  │ 서브쿼리 수: 5개                         │   │
│  └─────────────────────────────────────────┘   │
│                                                 │
│  쿼리 구조 분석                                 │
│  📊 테이블 목록 (18개)                         │
│  [users] [orders] [products] ...               │
│                                                 │
│  성능 분석                                      │
│  점수: 75/100 (GOOD)                           │
│  ⚠️ 이슈: 인덱스 미사용 경고                   │
│                                                 │
│  데이터 리니지                                  │
│  테이블: 18개 | CTE: 3개 | JOIN 관계: 51개     │
│  [테이블 선택 드롭다운]                        │
│                                                 │
│  [🌐 리니지 시각화 보기] [영향도 분석하기]     │
└─────────────────────────────────────────────────┘
```

### Python으로 직접 실행

```bash
# 기본 분석
python analyze-sql.py queries/complex_query.sql

# 또는
python test-sql-query-analyzer.py queries/complex_query.sql

# 영향도 분석
python test-sql-query-analyzer.py --impact --target_table users queries/complex_query.sql

# 영향도 분석 (컬럼 포함)
python test-sql-query-analyzer.py --impact --target_table users --target_column user_id queries/complex_query.sql

# 비교 분석 (PostgreSQL EXPLAIN ANALYZE와 비교)
python compare_sql_analyzers.py queries/complex_query_500.sql
```

### 분석 결과 파일 위치

- **JSON 리포트**: `queries/sql_analysis/{파일명}_analysis_{타임스탬프}.json`
- **마크다운 리포트**: `queries/sql_analysis/{파일명}_analysis_{타임스탬프}.txt`
- **리니지 JSON**: `queries/sql_analysis/{파일명}_lineage_visualization_{타임스탬프}.json`
- **리니지 HTML**: `queries/sql_analysis/{파일명}_lineage_visualization_{타임스탬프}.html`
- **영향도 분석 JSON**: 영향도 분석 결과는 API 응답으로 반환

### 큰 파일 처리

- **타임아웃**: 5분 (300초)
- **버퍼 크기**: 50MB
- **요청 본문 크기 제한**: 50MB

큰 파일(2000줄 이상) 분석 시 시간이 더 걸릴 수 있습니다.

### 리니지 시각화 특징

- **인터랙티브 그래프**: vis-network 라이브러리 사용
- **노드 클릭 기능**: 테이블 노드 클릭 시 자동으로 영향도 분석 실행
- **드래그 앤 줌**: 마우스로 그래프 이동 및 확대/축소 가능
- **테이블 구분**: 일반 테이블과 CTE를 색상으로 구분
- **관계 표시**: JOIN 관계를 엣지(선)로 시각화

### 영향도 분석 사용 시나리오

**시나리오 1: 테이블 스키마 변경**
- `users` 테이블의 컬럼을 변경하려고 할 때
- 영향도 분석으로 해당 테이블을 사용하는 모든 위치 확인
- JOIN 관계를 통한 간접 영향 확인

**시나리오 2: 데이터 마이그레이션**
- 특정 테이블의 데이터를 마이그레이션하기 전
- 영향받는 쿼리 및 테이블 사전 확인
- 마이그레이션 계획 수립

**시나리오 3: 성능 최적화**
- 특정 테이블의 인덱스를 추가하려고 할 때
- 해당 테이블을 사용하는 쿼리 확인
- 최적화 효과가 큰 쿼리 우선순위 결정

---

## 사용자 인증 및 관리

### 회원가입

1. 웹사이트에서 "회원가입" 버튼 클릭
2. 사용자명, 이메일, 비밀번호 입력
3. "가입하기" 버튼 클릭

### 로그인

1. "로그인" 버튼 클릭
2. 사용자명과 비밀번호 입력
3. "로그인" 버튼 클릭

### 사용자 관리

로그인 후 "사용자 관리하기" 메뉴에서:
- 프로필 수정
- 저장한 뉴스/음악/도서 조회
- API 키 관리

---

## API 키 사용

### API 키 생성

1. 웹사이트에 로그인
2. "사용자 관리하기" → "API 키 관리" 탭
3. "➕ 새 API 키 생성" 버튼 클릭
4. 생성된 API 키 복사

### API 키로 요청하기

```bash
curl -H "X-API-Key: YOUR_API_KEY" \
  "http://localhost:3001/api/news?q=AI"
```

### API 엔드포인트

- `GET /api/news?q={키워드}` - 뉴스 검색
- `GET /api/books/recommend?query={키워드}` - 도서 추천
- `GET /api/music/recommend?songTitle={노래제목}&artist={아티스트}` - 음악 추천
- `POST /api/sql/analyze` - SQL 쿼리 분석

---

## MCP 서버 설정

### Cursor AI에서 사용하기

`cursor-mcp-config.json` 파일에 MCP 서버 설정:

```json
{
  "mcpServers": {
    "unified-mcp-server": {
      "command": "python",
      "args": ["mcp-unified-server.py"],
      "cwd": "C:/test/test02"
    },
    "sql-query-analyzer": {
      "command": "python",
      "args": ["mcp-sql-query-analyzer.py"],
      "cwd": "C:/test/test02"
    }
  }
}
```

### MCP 서버 실행

```bash
# 통합 MCP 서버
npm run mcp-unified

# Node.js MCP 서버
npm run mcp-server

# SQL 쿼리 분석 MCP 서버
python mcp-sql-query-analyzer.py
```

---

## Docker 배포

### 빠른 시작

```bash
# 빌드 및 배포
scripts\docker-build.bat       # Windows
scripts\docker-deploy.bat      # Windows

./scripts/docker-build.sh      # Linux/macOS
./scripts/docker-deploy.sh    # Linux/macOS
```

### Docker 명령어

```bash
# 프로덕션 빌드 및 실행
docker-compose up -d --build

# 개발 환경 실행
docker-compose -f docker-compose.dev.yml up -d

# 서비스 중지
docker-compose down

# 로그 확인
docker-compose logs -f
```

> **📖 상세 가이드**: [`docs/Docker_빌드_배포_가이드.md`](./docs/Docker_빌드_배포_가이드.md)

---

## 문제 해결

### 포트 충돌 오류

**오류**: `Port 5173 is already in use`

**해결 방법:**
```bash
# 포트 사용 중인 프로세스 확인
netstat -ano | findstr :5173

# 프로세스 종료
taskkill /PID <PID> /F

# 또는 모든 서버 종료 후 재시작
stop-all-servers.bat
start-dev.bat
```

### SQL 쿼리 분석 타임아웃

**오류**: `요청 타임아웃: SQL 쿼리 분석에 시간이 너무 오래 걸립니다`

**해결 방법:**
- 쿼리를 더 작은 단위로 분할
- 복잡한 서브쿼리 최적화
- 인덱스 추가 고려

### API 서버 연결 오류

**오류**: `API 서버에 연결할 수 없습니다`

**해결 방법:**
1. API 서버가 실행 중인지 확인: `netstat -ano | findstr :3001`
2. 서버 재시작: `start-dev.bat`
3. 포트 충돌 확인 및 해결

### 리니지 시각화가 표시되지 않음

**해결 방법:**
1. 브라우저 콘솔에서 오류 확인 (F12)
2. 인터넷 연결 확인 (CDN 리소스 로드 필요)
3. 웹 서버를 통해 열기 (직접 파일 열기 대신)
4. API 서버 로그 확인

### 데이터베이스 오류

**해결 방법:**
```bash
# 데이터베이스 파일 확인
dir data\database.db

# 데이터베이스 재생성 (주의: 모든 데이터 삭제됨)
del data\database.db
npm run api-server  # 자동으로 재생성됨
```

---

## 📚 추가 문서

- [`docs/SQL_쿼리_분석_MCP_서버_가이드.md`](./docs/SQL_쿼리_분석_MCP_서버_가이드.md) - SQL 쿼리 분석 상세 가이드
- [`docs/Docker_빌드_배포_가이드.md`](./docs/Docker_빌드_배포_가이드.md) - Docker 배포 가이드
- [`README.md`](./README.md) - 프로젝트 개요

---

## 📄 라이선스

이 프로젝트는 개인 사용 목적으로 제작되었습니다.

---

**마지막 업데이트**: 2025년 1월
